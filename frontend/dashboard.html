<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading-X | ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
        }
        
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo h1 { color: #00d4ff; font-size: 24px; }
        .logo span { color: #ff6b6b; }
        
        .user-info { display: flex; align-items: center; gap: 20px; }
        .user-info span { color: #aaa; }
        
        .btn-logout {
            padding: 8px 20px;
            border: 1px solid #ff6b6b;
            background: transparent;
            color: #ff6b6b;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-logout:hover { background: #ff6b6b; color: white; }
        
        .main { padding: 30px; max-width: 1400px; margin: 0 auto; }
        
        .welcome { margin-bottom: 30px; }
        .welcome h2 { font-size: 28px; margin-bottom: 10px; }
        .welcome p { color: #888; }
        
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title { color: #aaa; font-size: 14px; }
        
        .card-icon {
            width: 40px; height: 40px;
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
        }
        
        .card-value { font-size: 32px; font-weight: 700; margin-bottom: 5px; }
        .card-change { font-size: 14px; }
        .card-change.positive { color: #00ff88; }
        .card-change.negative { color: #ff6b6b; }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title { font-size: 18px; font-weight: 600; }
        
        .btn-primary {
            padding: 10px 20px;
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }
        
        .account-list { display: flex; flex-direction: column; gap: 10px; }
        
        .account-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .account-info h4 { margin-bottom: 5px; color: #00d4ff; }
        .account-info span { color: #888; font-size: 14px; }
        
        .account-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .account-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .badge-demo { background: rgba(255, 193, 7, 0.2); color: #ffc107; }
        .badge-live { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        
        .btn-delete {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .btn-delete:hover { background: #ff6b6b; color: white; }
        
        .no-accounts {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .action-btn {
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .action-btn:hover {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
        }
        
        .action-btn .icon { font-size: 24px; margin-bottom: 10px; }
        
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.active { display: flex; }
        
        .modal-content {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 30px;
            width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-header h3 { font-size: 20px; }
        
        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
        }
        
        .form-group { margin-bottom: 20px; }
        
        .form-group label {
            display: block;
            color: #aaa;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 14px;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #00d4ff;
        }
        
        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .message.error {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }
        
        .message.success {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #888;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <h1>Trading<span>-X</span></h1>
        </div>
        <div class="user-info">
            <span id="userName">ì‚¬ìš©ì</span>
            <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>
    
    <main class="main">
        <div class="welcome">
            <h2>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, <span id="welcomeName">ì‚¬ìš©ì</span>ë‹˜!</h2>
            <p>ì˜¤ëŠ˜ë„ ì„±ê³µì ì¸ íŠ¸ë ˆì´ë”© ë˜ì„¸ìš”.</p>
        </div>
        
        <div class="cards">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ì´ ìì‚°</span>
                    <div class="card-icon" style="background: rgba(0, 212, 255, 0.2);">ğŸ’°</div>
                </div>
                <div class="card-value" id="totalBalance">$0.00</div>
                <div class="card-change positive" id="totalAccounts">ì—°ê²°ëœ ê³„ì •: 0ê°œ</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ì˜¤ëŠ˜ ìˆ˜ìµ</span>
                    <div class="card-icon" style="background: rgba(0, 255, 136, 0.2);">ğŸ“ˆ</div>
                </div>
                <div class="card-value" id="todayProfit">$0.00</div>
                <div class="card-change positive">+0.00%</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">í™œì„± í¬ì§€ì…˜</span>
                    <div class="card-icon" style="background: rgba(255, 107, 107, 0.2);">ğŸ“Š</div>
                </div>
                <div class="card-value" id="activePositions">0</div>
                <div class="card-change">ì§„í–‰ ì¤‘ì¸ ê±°ë˜</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ì—°ê²°ëœ EA</span>
                    <div class="card-icon" style="background: rgba(255, 193, 7, 0.2);">ğŸ¤–</div>
                </div>
                <div class="card-value" id="activeEAs">0</div>
                <div class="card-change">ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h3 class="section-title">ğŸ”— MT5 ê³„ì •</h3>
                <button class="btn-primary" onclick="openAddAccountModal()">+ ê³„ì • ì¶”ê°€</button>
            </div>
            <div class="account-list" id="accountList">
                <div class="loading">ê³„ì • ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h3 class="section-title">âš¡ ë¹ ë¥¸ ì‹¤í–‰</h3>
            </div>
            <div class="quick-actions">
                <button class="action-btn" onclick="openTrading()">
                    <div class="icon">ğŸ“ˆ</div>
                    <div>ë§¤ë§¤ ì‹œì‘</div>
                </button>
                <button class="action-btn" onclick="openEASettings()">
                    <div class="icon">ğŸ¤–</div>
                    <div>EA ì„¤ì •</div>
                </button>
                <button class="action-btn" onclick="openHistory()">
                    <div class="icon">ğŸ“‹</div>
                    <div>ê±°ë˜ ë‚´ì—­</div>
                </button>
                <button class="action-btn" onclick="openSettings()">
                    <div class="icon">âš™ï¸</div>
                    <div>ì„¤ì •</div>
                </button>
            </div>
        </div>
    </main>
    
    <!-- MT5 ê³„ì • ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal" id="addAccountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>MT5 ê³„ì • ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalMessage"></div>
            <form onsubmit="addAccount(event)">
                <div class="form-group">
                    <label>ê³„ì • ë²ˆí˜¸</label>
                    <input type="text" id="accountNumber" placeholder="MT5 ê³„ì • ë²ˆí˜¸" required>
                </div>
                <div class="form-group">
                    <label>ì„œë²„</label>
                    <input type="text" id="accountServer" placeholder="ì˜ˆ: MetaQuotes-Demo" required>
                </div>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="accountPassword" placeholder="MT5 ë¹„ë°€ë²ˆí˜¸" required>
                </div>
                <div class="form-group">
                    <label>ë¸Œë¡œì»¤</label>
                    <input type="text" id="brokerName" placeholder="ë¸Œë¡œì»¤ ì´ë¦„ (ì„ íƒ)">
                </div>
                <div class="form-group">
                    <label>ê³„ì • ìœ í˜•</label>
                    <select id="accountType">
                        <option value="true">ë°ëª¨ ê³„ì •</option>
                        <option value="false">ì‹¤ì œ ê³„ì •</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;" id="addAccountBtn">ê³„ì • ì¶”ê°€</button>
            </form>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://127.0.0.1:8000/api';
        
        // ì¸ì¦ í—¤ë” ê°€ì ¸ì˜¤ê¸°
        function getAuthHeaders() {
            const token = localStorage.getItem('access_token');
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            };
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            loadUserInfo();
            loadAccounts();
        });
        
        function loadUserInfo() {
            const userName = localStorage.getItem('user_name') || 'ì‚¬ìš©ì';
            document.getElementById('userName').textContent = userName;
            document.getElementById('welcomeName').textContent = userName;
        }
        
        // MT5 ê³„ì • ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadAccounts() {
            try {
                const response = await fetch(`${API_URL}/accounts/`, {
                    headers: getAuthHeaders()
                });
                
                if (response.status === 401) {
                    logout();
                    return;
                }
                
                const accounts = await response.json();
                renderAccounts(accounts);
            } catch (error) {
                console.error('ê³„ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('accountList').innerHTML = 
                    '<div class="no-accounts"><p>ê³„ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p></div>';
            }
        }
        
        // ê³„ì • ëª©ë¡ ë Œë”ë§
        function renderAccounts(accounts) {
            const container = document.getElementById('accountList');
            document.getElementById('totalAccounts').textContent = `ì—°ê²°ëœ ê³„ì •: ${accounts.length}ê°œ`;
            
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div class="no-accounts">
                        <p>ì—°ê²°ëœ MT5 ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="margin-top: 10px; font-size: 14px;">ê³„ì •ì„ ì¶”ê°€í•˜ì—¬ ìë™ë§¤ë§¤ë¥¼ ì‹œì‘í•˜ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = accounts.map(account => `
                <div class="account-item">
                    <div class="account-info">
                        <h4>${account.account_number}</h4>
                        <span>${account.server} ${account.broker_name ? 'â€¢ ' + account.broker_name : ''}</span>
                    </div>
                    <div class="account-status">
                        <span class="account-badge ${account.is_demo ? 'badge-demo' : 'badge-live'}">
                            ${account.is_demo ? 'ë°ëª¨' : 'ì‹¤ê³„ì •'}
                        </span>
                        <button class="btn-delete" onclick="deleteAccount(${account.id})">ì‚­ì œ</button>
                    </div>
                </div>
            `).join('');
        }
        
        // ê³„ì • ì¶”ê°€
        async function addAccount(e) {
            e.preventDefault();
            const btn = document.getElementById('addAccountBtn');
            btn.disabled = true;
            btn.textContent = 'ì¶”ê°€ ì¤‘...';
            
            const data = {
                account_number: document.getElementById('accountNumber').value,
                server: document.getElementById('accountServer').value,
                password: document.getElementById('accountPassword').value,
                broker_name: document.getElementById('brokerName').value || null,
                is_demo: document.getElementById('accountType').value === 'true'
            };
            
            try {
                const response = await fetch(`${API_URL}/accounts/`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showModalMessage('ê³„ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    setTimeout(() => {
                        closeModal();
                        loadAccounts();
                    }, 1000);
                } else {
                    showModalMessage(result.detail || 'ê³„ì • ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                showModalMessage('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
            
            btn.disabled = false;
            btn.textContent = 'ê³„ì • ì¶”ê°€';
        }
        
        // ê³„ì • ì‚­ì œ
        async function deleteAccount(accountId) {
            if (!confirm('ì •ë§ ì´ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch(`${API_URL}/accounts/${accountId}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                
                if (response.ok) {
                    loadAccounts();
                } else {
                    alert('ê³„ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function showModalMessage(text, type) {
            const msg = document.getElementById('modalMessage');
            msg.className = 'message ' + type;
            msg.textContent = text;
        }
        
        function openAddAccountModal() {
            document.getElementById('addAccountModal').classList.add('active');
            document.getElementById('modalMessage').className = '';
            document.getElementById('modalMessage').textContent = '';
            document.getElementById('accountNumber').value = '';
            document.getElementById('accountServer').value = '';
            document.getElementById('accountPassword').value = '';
            document.getElementById('brokerName').value = '';
        }
        
        function closeModal() {
            document.getElementById('addAccountModal').classList.remove('active');
        }
        
        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('user_name');
            window.location.href = 'login.html';
        }
        
        function openTrading() { alert('ë§¤ë§¤ í™”ë©´ì€ Phase 7ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤!'); }
        function openEASettings() { alert('EA ì„¤ì •ì€ Phase 7ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤!'); }
        function openHistory() { alert('ê±°ë˜ ë‚´ì—­ì€ Phase 6ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤!'); }
        function openSettings() { alert('ì„¤ì • í™”ë©´ì€ Phase 8ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤!'); }
        
        document.getElementById('addAccountModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
    </script>
</body>
</html>